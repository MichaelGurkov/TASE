
```{r load_libraries}

library(tidyverse)

library(xts)

library(lubridate)

devtools::load_all()

# library(MiscImport)

```


```{r import_ipo_list}

stocks_ipo = read_csv(paste0("C:\\Users\\internet",
                             "\\OneDrive - Bank Of Israel",
                             "\\Data\\TASE liquidity",
                             "\\michael files\\stocks_ipo.csv"),
                      show_col_types = FALSE) %>% 
  mutate(tase_id = as.character(tase_id))

itai_ipos = read_csv(paste0("C:\\Users\\internet",
                             "\\OneDrive - Bank Of Israel",
                             "\\Data\\TASE liquidity",
                             "\\michael files\\itai_ipos.csv"),
                      show_col_types = FALSE) %>% 
  mutate(tase_id = as.character(tase_id))

```


```{r import_market_df}


market_file_path = paste0(Sys.getenv("USERPROFILE"),
                          "\\OneDrive - Bank Of Israel\\Data",
                          "\\TASE liquidity\\Rdata files",
                          "\\market_data_2022-11-15.rds")


market_df  = import_boi_market_data(market_file_path) %>% 
  filter(!is.na(close))

rm(market_file_path)






```


```{r import_cumulative_ret_df_for_all}

cum_ret_for_all_comps_df = read_rds(paste0(
  Sys.getenv("USERPROFILE"),
  "\\OneDrive - Bank Of Israel\\Data",
  "\\TASE liquidity\\Rdata files",
  "\\ret_for_all_comps_df.rds"))


# ret_for_all_comps_df = write_rds(paste0(
#   Sys.getenv("USERPROFILE"),
#   "\\OneDrive - Bank Of Israel\\Data",
#   "\\TASE liquidity\\Rdata files",
#   "\\ret_for_all_comps_df.rds"))


```


```{r plot_ipo_price}

market_df %>% 
  inner_join(select(itai_ipos, tase_id)) %>% 
  filter(date >= dmy("30-06-2021") & date <= dmy("31-01-2022")) %>% 
  group_by(tase_id) %>% 
  mutate(close = close / close[date == min(date)]) %>% 
  group_by(date) %>% 
  summarise(qs = quantile(close, c(0.25,0.5,0.75)),
            probs = c(0.25,0.5,0.75), .groups = "drop") %>% 
  ggplot(aes(date, qs, color = as.character(probs))) + 
  geom_line()

```

