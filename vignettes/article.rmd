
```{r , child="import_data.Rmd"}

```


```{r cumulative_returns}

cum_ret_df = ret_df %>% 
  calculate_cum_return()

```

```{r holding_returns}

hold_ret = calculate_holding_return(ret_df)

```



```{r plot_cum_ret}

cum_ret_df %>% 
  ggplot(aes(month, value, color = adjustment_type)) +
  geom_line() +
  geom_hline(yintercept = 0, linetype = "dashed") +
  scale_y_continuous(labels = scales::percent_format()) +
  xlab("Months since IPO") + ylab(NULL) +
  ggtitle("Cumulative returns since IPO") +
  theme(legend.title = element_blank())



```


```{r plot_returns_by_year}

bhar_year_ret = stocks_ipo %>% 
  select(tase_id, indicator = year) %>% 
  group_by(tase_id) %>% 
  summarise(indicator = min(indicator), .groups = "drop") %>% 
  calculate_holding_return_by_indicator(ret_df = ret_df,
                                                      ind_df = .) %>% 
  rename(year = indicator)

bhar_year_ret %>% 
  filter(!adjustment_type == "Control adjusted returns") %>% 
  pivot_wider(names_from = adjustment_type) %>% 
  write_csv(paste0("C:\\Users\\internet",
                  "\\OneDrive - Bank Of Israel\\current_work",
                  "\\annual_report\\2022\\data\\plots",
                  "\\updated_box_plots\\bhar_ret_plot.csv"))


```

