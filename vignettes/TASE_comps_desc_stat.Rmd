---
title: "TASE companies evolution"
output: pdf_document
---

```{r setup, include=FALSE,}

knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)

```


```{r Load_libraries}

library(devtools)

library(tidyverse)

library(xts)

library(stargazer)

library(readxl)

load_all()

```


```{r Import_data}

status_df = import.TASE.comps_status()

```


```{r plot_comps_evolution}

comps_evolution_plot = ggplot(status_df %>% 
                                filter(Sector == "Total"),
                              aes(x = Year, y = End_Year, group = 1)) + 
  geom_col(width = 0.7) + 
  geom_text(aes(x = Year, y = End_Year, label = End_Year), vjust = -1,
            color = "magenta", size = 3) + 
  labs(x = "", y = "", title = "Number of listed companies in TASE") + 
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5), axis.text.x = element_text(angle = 90))

y_range = ggplot_build(comps_evolution_plot)$layout$panel_params[[1]]$y.range

y_range[2] = 1.05 * y_range[2]

print(comps_evolution_plot + 
        ylim(y_range))

rm(y_range)

```

Number of listed companies has been declining since it peaked at 2007-2008, there are currently 
`r status_df$End_Year[status_df$Sector == "Total" & status_df$Year == max(status_df$Year)]` listed
on the exchange.The average number has been `r mean(status_df$End_Year[status_df$Sector == "Total"])`
companies.


```{r plot_comps_evolution_by_sectype}

ggplot(status_df %>% 
  filter(Sector %in% c("Total Shares","Total Bonds")),
  aes(x = Year, y = End_Year, group = Sector, fill = Sector)) + 
  geom_col(position = "dodge") + 
  labs(x = "", y = "", title = "Number of listed companies in TASE") + 
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5), legend.position = "bottom",
        axis.text.x = element_text(angle = 90))

```


```{r plot_comps_evolution_by_sector}

ggplot(status_df %>% 
  filter(!Sector %in% grep("Total",unique(Sector),value = TRUE)),
  aes(x = Year, y = End_Year, group = Sector, fill = Sector, label = End_Year)) + 
  geom_bar(stat = "identity") + 
  # geom_text(size = 3, position = position_stack(vjust = 0.5)) + 
  scale_fill_brewer(type = "div", palette = "Spectral") + 
  labs(x = "", y = "", title = "Number of listed companies in TASE \n (by sector)") + 
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5), legend.position = "bottom",
        axis.text.x = element_text(angle = 90), legend.title = element_blank())

```

A study of sector evolution reveals that the most prominent and stable sectors are: industry,
real estate, services and holdings. However in the last 5 years holding's and service's share
decreased significantly while new sectors such as technology and biomed entered the stage.


\subsection{Delisting companies}

```{r plot_delisting_comps}

delisted_comps_plot = ggplot(status_df %>% 
         filter(Sector == "Total"), aes(x = Year, y = Delisted_Comps, label = Delisted_Comps)) + 
  geom_col(width = 0.7) + 
  geom_text(aes(x = Year, y = Delisted_Comps), vjust = -1,
            color = "magenta", size = 3) + 
  labs(x = "", y = "", title = "Number of delisted companies") + 
  theme_bw() + 
  theme(axis.text.x = element_text(angle = 90), plot.title = element_text(hjust = 0.5))

y_range = ggplot_build(delisted_comps_plot)$layout$panel_params[[1]]$y.range

y_range[2] = 1.02 * y_range[2]

print(delisted_comps_plot + 
        ylim(y_range))

rm(y_range)

```

We can see that the peak in delisting companies took place in 2012-2014 period, 2018 was also a year
with significant delisting activity.
