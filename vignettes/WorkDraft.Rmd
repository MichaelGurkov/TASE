---
title: "Work outline"
header-includes:
   - \usepackage{xcolor}
output: pdf_document
---

```{r setup, include=FALSE,}

knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)

```


```{r Load_libraries}

library(haven)

library(devtools)

library(tidyverse)


library(stargazer)

library(texreg)

load_all()

```


```{r Set_parameters}

params_list = list()

params_list$x_vars = tolower(c("Illiq","Market_Cap_log","Turnover_log",
                               "Insider_ownership","HHI","IPO","Total_Assets",
                               "Operating_Profit","Revenue","Net_Profit",
                               "Equity","Total_Liabilities","Leverage"))

params_list$reg_vars = c("delisted","leverage","mb","capex_sales","roa",
                         "free_cash_flow","insider_ownership","size",
                         "log_trade_volume","illq")

```


```{r Import_data}

raw_df = read_dta(paste0(file.path(Sys.getenv("USERPROFILE"),fsep="\\"),
                     "\\OneDrive - Bank Of Israel\\Data\\TASE",
                     " liquidity\\Stata files\\TASE panel.dta"))

df = raw_df %>% 
  rename_all(.funs = ~tolower(.)) %>% 
  rename(capex_sales = capex2sales) %>% 
  rename(comp_num = msp_hvr) %>% 
  rename(sector = anaf_hvr) %>% 
  rename(date = newdate) %>% 
  mutate(date = as.yearqtr(date)) %>% 
  select(comp_num,sector,date,
         any_of(params_list$reg_vars),ipo_dummy,
         match, treat) %>% 
  mutate(match = replace_na(match,0)) %>% 
  filter(complete.cases(.))

control_df = df %>% 
  filter(comp_num %in% unique(df$match) & treat == 0)

treat_df = df %>% 
  filter(treat == 1)


```


\section{Introduction}

The purpose of the work is to identify the reasons
of firm's delistings from trade. The method is a logit regression that evaluates firm's characteristics in a sample
that consists of delisted firms and matched trading firms.

\section{Empirical specification}

\begin{align*}
	Pr(Delisting)  = \alpha & + \beta_{1} Leverage + \beta_{2} MB  
	                          + \beta_{3} CAPEX  + \beta_{4}ROA\\ 
	                        & + \beta{5} FreeCashFlow 
	                          + \beta_{6} InsiderOwnership \\
                          & + \beta_{7} Size + \beta_{8} TradeVolume 
                            + \beta_{9} Illiqudity
\end{align*}

Where:

\begin{itemize}
  \item
  \textcolor{red}{InsiderOwnership - currently using Public share (1-free float),
  maybe try your algorithm controlling shareholder data?}

\end{itemize}


\section{Descriptive Stats}


```{r df_stat,results='asis'}

stargazer(df %>% 
            select(-treat, -match, -comp_num,-sector) %>% 
            as.data.frame(),
          header = FALSE,
          omit.summary.stat = c("p25","p75"), digits = 2)

```

\subsection{Treatment vs Control}


```{r means_comparison, eval=FALSE}

test_res = lapply(params_list$reg_vars[-1], function(temp_var){
  
  test_res = t.test(control_df[[temp_var]], treat_df[[temp_var]])
  
})

```


```{r results="asis"}

stargazer(list(as.data.frame(treat_df),as.data.frame(control_df)),
          header = FALSE)

```





<!-- Model fit -->

```{r fit_model}

logit_mod = glm(delisted ~ .,
                     data = df %>% select(params_list$reg_vars),
                     family=binomial(link = "logit"))


```


```{r out_star, results="asis"}


stargazer(logit_mod)


```



<!-- \section{Results} -->



<!-- \section{Appendix} -->

```{r ,child="Appendix.Rmd", eval = FALSE}

```

